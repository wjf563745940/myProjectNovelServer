webpackJsonp([7],{208:function(t,e,o){o(251);var n=o(8)(o(237),o(256),"data-v-09060798",null);t.exports=n.exports},216:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(75),a=o.n(n);e.default={props:{backText:{type:String,default:"返回"},curText:{type:String,default:"详情"},curText2:{type:String,default:"返回"}},data:function(){return{menu_active:{text:"列表"},dictId:"utilItems",selectShow:{isShow:!1}}},components:{selectBox2:a.a},methods:{back:function(){this.$router.go(-1)},getSelectSex:function(t){this.selectShow=!1},getSexs:function(){this.dictId="utilItems",console.log(this.selectShow),this.selectShow={isShow:!0}}}}},217:function(t,e,o){e=t.exports=o(203)(!0),e.push([t.i,".select-type{position:absolute}","",{version:3,sources:["G:/work/my-project-novel/src/components/index-header2.vue"],names:[],mappings:"AACA,aAEC,iBAAmB,CACnB",file:"index-header2.vue",sourcesContent:["\n.select-type{\n\n\tposition: absolute;\n}\n"],sourceRoot:""}])},218:function(t,e,o){var n=o(217);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o(204)("431edeb5",n,!0)},219:function(t,e,o){o(218);var n=o(8)(o(216),o(220),null,null);t.exports=n.exports},220:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_cover-top"},[o("div",{staticClass:"top-back",on:{click:t.back}},[o("div",{staticClass:"_ellipsis iconfont icon-return-arrow v-link-active"},[t._v(t._s(t.backText))])]),t._v(" "),o("div",{staticClass:"header-other"},[o("span",{staticClass:"iconfont icon-tips-jia",on:{click:t.getSexs}}),t._v(" "),o("div",{staticClass:"select-type"},[o("selectBox2",{attrs:{radioShOW:!1,"dict-id":t.dictId},on:{selectIndex:t.getSelectSex},model:{value:t.selectShow,callback:function(e){t.selectShow=e},expression:"selectShow"}})],1)]),t._v(" "),o("div",{staticClass:"center"},[t._v("\n\t\t\t "+t._s(t.curText)+"\n\t\t")])])},staticRenderFns:[]}},221:function(t,e,o){"use strict";function n(t){var e=t||"novel",o=new PouchDB(e);return console.log("init pounchdb"),o}function a(t,e){return t.post(e)}function s(t,e){return t.get(e)}function i(t,e,o){return o._id=e,t.put(o)}function l(t,e,o,n){var a=!1;"[object Array]"===Object.prototype.toString.call(e)&&(a=!0);var s=o.map(function(t){var o="";return a?e.forEach(function(e,a){o+=(n?n[a]:"")+t[e]}):o=(n||"")+t[e],t._id=o,t});return console.log(s),t.bulkDocs(s)}var r={initDB:n,addData:a,putData:i,getById:s,mulPutDatas:l};e.a=r},232:function(t,e,o){"use strict"},237:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=o(33),a=o.n(n),s=o(21),i=o.n(s),l=o(219),r=o.n(l),u=o(20),c=(o(232),o(76)),d=o(221);e.default={name:"novelMenu",data:function(){return{topModel:{curText:"下载",backText:"列表"},list:[],myDb:{},dbname:"novel",keyPaths:["chapter_id","novel_chapter_id"],keyPath:"chapter_id",isbottomAllLoaded:!1,offset:0,offsetNum:100,downNum:100,value:[],osnovel:"novels",options:[]}},computed:a()({osname:function(){return"chapter"+this.$route.query.novelId},downname:function(){return 0===this.value.length?"请选择":"下载"},isActiveSelect:function(){return 0!==this.value.length},osnames:function(){return["chapter"+this.$route.query.novelId,"novel_content"+this.$route.query.novelId]}},o.i(u.b)({getVersion:"getVersion"})),components:{indexHeader:r.a},created:function(){var t=this;this.myDb=d.a.initDB("novelChapter"),t.initPounchDbData()},methods:a()({initPounchDbData:function(){var t=this;d.a.getById(t.myDb,"chapter"+t.$route.query.novelId).then(function(e){if(console.log(e),e.error&&"missing"===e.reason){t.getNovelChapter().then(function(t){var e=[];console.log(t),t.data.results.forEach(function(t,o){t.downstatue=!1,e.push(t)})})}else{var o=[],n=0;e.data.forEach(function(a,s){if(s+=1,a.downstatue&&n++,s%t.downNum==0){var i={label:"第"+(s-t.downNum+1)+"章~第"+s+"章",value:{start:s-t.downNum+1,end:s}};console.log(n),n%t.downNum==0&&0!=n&&(i.disabled=!0),o.push(i),n=0}else if(s==e.length){var l=e.length%t.downNum,r={label:"第"+(s-l+1)+"章~第"+s+"章",value:{start:s-t.downNum+1,end:s}};n===l&&(r.disabled=!0),o.push(r),n=0}}),t.options=o}}).catch(function(e){if(console.log(e),e.error&&"missing"===e.reason){t.getNovelChapter().then(function(e){var o=[];console.log(e),e.data.results.forEach(function(t,e){t.downstatue=!1,o.push(t)}),d.a.putData(t.myDb,"chapter"+t.$route.query.novelId,{data:o})})}})},initDbData:function(){var t=this;c.a.fetchStoreByCursor(t.myDb.db,"chapter"+t.$route.query.novelId,function(e){if(0===e.length){t.getNovelChapter().then(function(e){var o=[];console.log(e),e.data.results.forEach(function(t,e){t.downstatue=!1,o.push(t)}),c.a.addData(t.myDb.db,"chapter"+t.$route.query.novelId,o),t.myDb.db.close()})}else{var o=[],n=0;e.forEach(function(a,s){if(s+=1,a.downstatue&&n++,s%t.downNum==0){var i={label:"第"+(s-t.downNum+1)+"章~第"+s+"章",value:{start:s-t.downNum+1,end:s}};console.log(n),n%t.downNum==0&&0!=n&&(i.disabled=!0),o.push(i),n=0}else if(s==e.length){var l=e.length%t.downNum,r={label:"第"+(s-l+1)+"章~第"+s+"章",value:{start:s-t.downNum+1,end:s}};n===l&&(r.disabled=!0),o.push(r),n=0}}),t.myDb.db.close(),t.options=o}})},getNovel:function(t){var e=this,o=e.infoLists[t],n=o.id;c.a.getDataByIndex(e.myDb.db,e.osname,n,e.keyPath,function(t){t?(e.myDb.db.close(),e.$router.push("/novelList/detail?novelId="+n+"&novelChapterId="+t.currentChapter)):(o.currentChapter=1,c.a.addData(e.myDb.db,e.osname,[o]),e.myDb.db.close(),e.$router.push("/novelList/detail?novelId="+n+"&novelChapterId=1"))})},getNovelChapter:function(){var e=this;return i.a.get(t.URL_PREFIX+"/getChapters?novelId="+this.$route.query.novelId+"&offset="+e.offset).then(function(t){var o=[];return t.data.results.forEach(function(n,a){if((a+=1)%e.downNum==0)console.log("mydb",e.myDb),o.push({label:"第"+(a-e.downNum+1)+"章~第"+a+"章",value:{start:a-e.downNum+1,end:a}});else if(a==t.data.results.length){var s=t.data.results.length%e.downNum;o.push({label:"第"+(a-s+1)+"章~第"+a+"章",value:{start:a-e.downNum+1,end:a}})}}),e.options=o,t})},infoDetail:function(t){this.$router.push("/novelList/detail?novelId="+this.$route.query.novelId+"&novelChapterId="+this.list[t].chapter_id)},loadTop:function(){console.log("loadTop");var e=this;i.a.get(t.URL_PREFIX+"/getChapters?novelId="+this.$route.query.novelId+"&offset="+e.offset).then(function(t){var o=[];t.data.results.forEach(function(n,a){if((a+=1)%e.downNum==0)o.push({label:"第"+(a-e.downNum+1)+"章~第"+a+"章",value:{start:a-e.downNum+1,end:a}});else if(a==t.data.results.length){var s=t.data.results.length%e.downNum;o.push({label:"第"+(a-s+1)+"章~第"+a+"章",value:{start:a-e.downNum+1,end:a}})}}),e.options=o}).catch(function(t){console.log(t)}),this.$refs.loadmore.onTopLoaded()},loadBottom:function(){console.log("loadBottom")},allLoaded:function(){},bottomAllLoaded:function(){},novelDownload:function(){var t=this,e="";t.value.forEach(function(t,o){for(var n=t.start;n<=t.end;n++)e+=""===e?n+"":","+n}),t.download(e)},download:function(e){var o=this,n=o.$route.query.novelId;i.a.get(t.URL_PREFIX+"/downloadNovelContentById?novelId="+this.$route.query.novelId+"&in="+e).then(function(t){console.log(t);var a=d.a.initDB("novelContent");d.a.mulPutDatas(a,["novel_id","novel_chapter_id"],t.data.results,["novel_id","novel_chapter_id"]),d.a.getById(o.myDb,"chapter"+o.$route.query.novelId).then(function(t){if(t.data){var a=e.split(",");t.data.forEach(function(t,e){-1!==a.indexOf(t.chapter_id+"")&&(t.downstatue=!0)}),d.a.putData(o.myDb,"chapter"+o.$route.query.novelId,t);var s=d.a.initDB("novel");d.a.getById(s,"novel"+n).then(function(t){t.currentChapter=1,t.downstatue=!0,d.a.putData(s,"novel"+n,t)}).catch(function(t){if("not_found"===t.name){var e={novel_id:n};e.currentChapter=1,e.downstatue=!1,d.a.putData(s,"novel"+n,e)}})}})})}},o.i(u.c)({setDbVersion:"setDbVersion"}))}}.call(e,o(5))},246:function(t,e,o){e=t.exports=o(203)(!0),e.push([t.i,".app-content[data-v-09060798]{overflow-y:auto}.btn-fixed-bottom[data-v-09060798]{position:fixed;bottom:0;left:0;width:100%}.btn-fixed-bottom .active[data-v-09060798]{background:#26a2ff;color:#fff}","",{version:3,sources:["G:/work/my-project-novel/src/views/info/novelMenuDownload.vue"],names:[],mappings:"AACA,8BACC,eAAiB,CACjB,AACD,mCACC,eAAgB,AAChB,SAAU,AACV,OAAQ,AACR,UAAY,CACZ,AACD,2CACC,mBAAoB,AACpB,UAAW,CACX",file:"novelMenuDownload.vue",sourcesContent:["\n.app-content[data-v-09060798]{\n\toverflow-y: auto;\n}\n.btn-fixed-bottom[data-v-09060798]{\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\twidth: 100%;\n}\n.btn-fixed-bottom .active[data-v-09060798]{\n\tbackground: #26a2ff;\n\tcolor:#fff;\n}\n"],sourceRoot:""}])},251:function(t,e,o){var n=o(246);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o(204)("d8a670a6",n,!0)},256:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"_full_router component-chat-detail "},[o("div",{staticClass:"_full_inner"},[o("header",{staticClass:"app-header"},[o("indexHeader",{attrs:{"back-text":t.topModel.backText,"cur-text":t.topModel.curText}})],1),t._v(" "),o("div",{staticClass:"app-content"},[o("mt-checklist",{attrs:{title:"下载列表",alignt:"left",options:t.options},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),t._v(" "),o("div",{staticClass:"btn-fixed-bottom"},[o("mt-button",{class:{active:t.isActiveSelect},attrs:{disabled:!t.isActiveSelect,size:"large",type:"default"},on:{click:t.novelDownload}},[t._v(t._s(t.downname))])],1)],1)])])},staticRenderFns:[]}}});
//# sourceMappingURL=7.3b5fd82ee990ee8ad2c3.js.map